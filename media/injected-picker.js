(()=>{"use strict";const e=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function t(e){const t=[];for(let n=0,o=e.length;n<o;n++)t.push(e[n]);return t}let n=null;function o(e={}){return n||(e.includeStyleProperties?(n=e.includeStyleProperties,n):(n=t(window.getComputedStyle(document.documentElement)),n))}function r(e,t){const n=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return n?parseFloat(n.replace("px","")):0}function i(e,t={}){return{width:t.width||function(e){const t=r(e,"border-left-width"),n=r(e,"border-right-width");return e.clientWidth+t+n}(e),height:t.height||function(e){const t=r(e,"border-top-width"),n=r(e,"border-bottom-width");return e.clientHeight+t+n}(e)}}const s=16384;function l(e){return new Promise((t,n)=>{const o=new Image;o.onload=()=>{o.decode().then(()=>{requestAnimationFrame(()=>t(o))})},o.onerror=n,o.crossOrigin="anonymous",o.decoding="async",o.src=e})}const a=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return null!==n&&(n.constructor.name===t.name||a(n,t))};function c(t,n,r,i){const s=window.getComputedStyle(t,r),l=s.getPropertyValue("content");if(""===l||"none"===l)return;const a=e();try{n.className=`${n.className} ${a}`}catch(e){return}const c=document.createElement("style");c.appendChild(function(e,t,n,r){const i=`.${e}:${t}`,s=n.cssText?function(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}(n):function(e,t){return o(t).map(t=>`${t}: ${e.getPropertyValue(t)}${e.getPropertyPriority(t)?" !important":""};`).join(" ")}(n,r);return document.createTextNode(`${i}{${s}}`)}(a,r,s,i)),n.appendChild(c)}const d="application/font-woff",u="image/jpeg",h={woff:d,woff2:d,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:u,jpeg:u,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function p(e){const t=function(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}(e).toLowerCase();return h[t]||""}function g(e){return-1!==e.search(/^(data:)/)}function m(e,t){return`data:${t};base64,${e}`}async function f(e,t,n){const o=await fetch(e,t);if(404===o.status)throw new Error(`Resource "${o.url}" not found`);const r=await o.blob();return new Promise((e,t)=>{const i=new FileReader;i.onerror=t,i.onloadend=()=>{try{e(n({res:o,result:i.result}))}catch(e){t(e)}},i.readAsDataURL(r)})}const w={};async function y(e,t,n){const o=function(e,t,n){let o=e.replace(/\?.*/,"");return n&&(o=e),/ttf|otf|eot|woff2?/i.test(o)&&(o=o.replace(/.*\//,"")),t?`[${t}]${o}`:o}(e,t,n.includeQueryParams);if(null!=w[o])return w[o];let r;n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const o=await f(e,n.fetchRequestInit,({res:e,result:n})=>(t||(t=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(n)));r=m(o,t)}catch(t){r=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;t&&(o="string"==typeof t?t:t.message),o&&console.warn(o)}return w[o]=r,r}const b=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),E=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();async function v(e,n,r){return r||!n.filter||n.filter(e)?Promise.resolve(e).then(e=>async function(e,t){return a(e,HTMLCanvasElement)?async function(e){const t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):l(t)}(e):a(e,HTMLVideoElement)?async function(e,t){if(e.currentSrc){const t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==n||n.drawImage(e,0,0,t.width,t.height),l(t.toDataURL())}const n=e.poster,o=p(n);return l(await y(n,o,t))}(e,t):a(e,HTMLIFrameElement)?async function(e,t){var n;try{if(null===(n=null==e?void 0:e.contentDocument)||void 0===n?void 0:n.body)return await v(e.contentDocument.body,t,!0)}catch(e){}return e.cloneNode(!1)}(e,t):e.cloneNode(E(e))}(e,n)).then(o=>async function(e,n,o){var r,i;if(E(n))return n;let s=[];return s=b(e)&&e.assignedNodes?t(e.assignedNodes()):a(e,HTMLIFrameElement)&&(null===(r=e.contentDocument)||void 0===r?void 0:r.body)?t(e.contentDocument.body.childNodes):t((null!==(i=e.shadowRoot)&&void 0!==i?i:e).childNodes),0===s.length||a(e,HTMLVideoElement)||await s.reduce((e,t)=>e.then(()=>v(t,o)).then(e=>{e&&n.appendChild(e)}),Promise.resolve()),n}(e,o,n)).then(t=>function(e,t,n){return a(t,Element)&&(function(e,t,n){const r=t.style;if(!r)return;const i=window.getComputedStyle(e);i.cssText?(r.cssText=i.cssText,r.transformOrigin=i.transformOrigin):o(n).forEach(n=>{let o=i.getPropertyValue(n);if("font-size"===n&&o.endsWith("px")){const e=Math.floor(parseFloat(o.substring(0,o.length-2)))-.1;o=`${e}px`}a(e,HTMLIFrameElement)&&"display"===n&&"inline"===o&&(o="block"),"d"===n&&t.getAttribute("d")&&(o=`path(${t.getAttribute("d")})`),r.setProperty(n,o,i.getPropertyPriority(n))})}(e,t,n),function(e,t,n){c(e,t,":before",n),c(e,t,":after",n)}(e,t,n),function(e,t){a(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),a(e,HTMLInputElement)&&t.setAttribute("value",e.value)}(e,t),function(e,t){if(a(e,HTMLSelectElement)){const n=t,o=Array.from(n.children).find(t=>e.value===t.getAttribute("value"));o&&o.setAttribute("selected","")}}(e,t)),t}(e,t,n)).then(e=>async function(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===n.length)return e;const o={};for(let r=0;r<n.length;r++){const i=n[r].getAttribute("xlink:href");if(i){const n=e.querySelector(i),r=document.querySelector(i);n||!r||o[i]||(o[i]=await v(r,t,!0))}}const r=Object.values(o);if(r.length){const t="http://www.w3.org/1999/xhtml",n=document.createElementNS(t,"svg");n.setAttribute("xmlns",t),n.style.position="absolute",n.style.width="0",n.style.height="0",n.style.overflow="hidden",n.style.display="none";const o=document.createElementNS(t,"defs");n.appendChild(o);for(let e=0;e<r.length;e++)o.appendChild(r[e]);e.appendChild(n)}return e}(e,n)):null}const x=/url\((['"]?)([^'"]+?)\1\)/g,S=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,$=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function C(e){return-1!==e.search(x)}async function k(e,t,n){if(!C(e))return e;const o=function(e,{preferredFontFormat:t}){return t?e.replace($,e=>{for(;;){const[n,,o]=S.exec(e)||[];if(!o)return"";if(o===t)return`src: ${n};`}}):e}(e,n),r=function(e){const t=[];return e.replace(x,(e,n,o)=>(t.push(o),e)),t.filter(e=>!g(e))}(o);return r.reduce((e,o)=>e.then(e=>async function(e,t,n,o,r){try{const i=n?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),o=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(o),n.body.appendChild(r),t&&(o.href=t),r.href=e,r.href}(t,n):t,s=p(t);let l;return l=r?m(await r(i),s):await y(i,s,o),e.replace(function(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}(t),`$1${l}$3`)}catch(e){}return e}(e,o,t,n)),Promise.resolve(o))}async function D(e,t,n){var o;const r=null===(o=t.style)||void 0===o?void 0:o.getPropertyValue(e);if(r){const o=await k(r,null,n);return t.style.setProperty(e,o,t.style.getPropertyPriority(e)),!0}return!1}async function P(e,n){a(e,Element)&&(await async function(e,t){await D("background",e,t)||await D("background-image",e,t),await D("mask",e,t)||await D("-webkit-mask",e,t)||await D("mask-image",e,t)||await D("-webkit-mask-image",e,t)}(e,n),await async function(e,t){const n=a(e,HTMLImageElement);if((!n||g(e.src))&&(!a(e,SVGImageElement)||g(e.href.baseVal)))return;const o=n?e.src:e.href.baseVal,r=await y(o,p(o),t);await new Promise((o,i)=>{e.onload=o,e.onerror=t.onImageErrorHandler?(...e)=>{try{o(t.onImageErrorHandler(...e))}catch(e){i(e)}}:i;const s=e;s.decode&&(s.decode=o),"lazy"===s.loading&&(s.loading="eager"),n?(e.srcset="",e.src=r):e.href.baseVal=r})}(e,n),await async function(e,n){const o=t(e.childNodes).map(e=>P(e,n));await Promise.all(o).then(()=>e)}(e,n))}const R={};async function B(e){let t=R[e];if(null!=t)return t;const n=await fetch(e);return t={url:e,cssText:await n.text()},R[e]=t,t}async function L(e,t){let n=e.cssText;const o=/url\(["']?([^"')]+)["']?\)/g,r=(n.match(/url\([^)]+\)/g)||[]).map(async r=>{let i=r.replace(o,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),f(i,t.fetchRequestInit,({result:e})=>(n=n.replace(r,`url(${e})`),[r,e]))});return Promise.all(r).then(()=>n)}function U(e){if(null==e)return[];const t=[];let n=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const o=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=o.exec(n);if(null===e)break;t.push(e[0])}n=n.replace(o,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=r.exec(n);if(null===e){if(e=i.exec(n),null===e)break;r.lastIndex=i.lastIndex}else i.lastIndex=r.lastIndex;t.push(e[0])}return t}function M(e){return e.trim().replace(/["']/g,"")}async function T(e,n){const o=await async function(e,n){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const o=t(e.ownerDocument.styleSheets),r=await async function(e,n){const o=[],r=[];return e.forEach(o=>{if("cssRules"in o)try{t(o.cssRules||[]).forEach((e,t)=>{if(e.type===CSSRule.IMPORT_RULE){let i=t+1;const s=B(e.href).then(e=>L(e,n)).then(e=>U(e).forEach(e=>{try{o.insertRule(e,e.startsWith("@import")?i+=1:o.cssRules.length)}catch(t){console.error("Error inserting rule from remote css",{rule:e,error:t})}})).catch(e=>{console.error("Error loading remote css",e.toString())});r.push(s)}})}catch(t){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=o.href&&r.push(B(o.href).then(e=>L(e,n)).then(e=>U(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{console.error("Error loading remote stylesheet",e)})),console.error("Error inlining remote css file",t)}}),Promise.all(r).then(()=>(e.forEach(e=>{if("cssRules"in e)try{t(e.cssRules||[]).forEach(e=>{o.push(e)})}catch(t){console.error(`Error while reading CSS rules from ${e.href}`,t)}}),o))}(o,n);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>C(e.style.getPropertyValue("src")))}(r)}(e,n),r=function(e){const t=new Set;return function e(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(e=>{t.add(M(e))}),Array.from(n.children).forEach(t=>{t instanceof HTMLElement&&e(t)})}(e),t}(e);return(await Promise.all(o.filter(e=>r.has(M(e.style.fontFamily))).map(e=>{const t=e.parentStyleSheet?e.parentStyleSheet.href:null;return k(e.cssText,t,n)}))).join("\n")}async function N(e,t={}){const{width:n,height:o}=i(e,t),r=await v(e,t,!0);return await async function(e,t){const n=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await T(e,t);if(n){const t=document.createElement("style"),o=document.createTextNode(n);t.appendChild(o),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}(r,t),await P(r,t),function(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const o=t.style;null!=o&&Object.keys(o).forEach(e=>{n[e]=o[e]})}(r,t),await async function(e,t,n){const o="http://www.w3.org/2000/svg",r=document.createElementNS(o,"svg"),i=document.createElementNS(o,"foreignObject");return r.setAttribute("width",`${t}`),r.setAttribute("height",`${n}`),r.setAttribute("viewBox",`0 0 ${t} ${n}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),r.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(r)}(r,n,o)}async function I(e,t={}){return(await async function(e,t={}){const{width:n,height:o}=i(e,t),r=await N(e,t),a=await l(r),c=document.createElement("canvas"),d=c.getContext("2d"),u=t.pixelRatio||function(){let e,t;try{t=process}catch(e){}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),h=t.canvasWidth||n,p=t.canvasHeight||o;return c.width=h*u,c.height=p*u,t.skipAutoScale||function(e){(e.width>s||e.height>s)&&(e.width>s&&e.height>s?e.width>e.height?(e.height*=s/e.width,e.width=s):(e.width*=s/e.height,e.height=s):e.width>s?(e.height*=s/e.width,e.width=s):(e.width*=s/e.height,e.height=s))}(c),c.style.width=`${h}`,c.style.height=`${p}`,t.backgroundColor&&(d.fillStyle=t.backgroundColor,d.fillRect(0,0,c.width,c.height)),d.drawImage(a,0,0,c.width,c.height),c}(e,t)).toDataURL()}console.log("[VisualBrowser] Injected script loaded!"),function(){if(window.__visualBrowserPickerInjected)return void console.log("[VisualBrowser] Script already injected, skipping...");window.__visualBrowserPickerInjected=!0,console.log("[VisualBrowser] Initializing picker...");let e=!1,t=null,n=!1;const o=document.createElement("div");o.id="visual-browser-injected-overlay",o.style.cssText="\n        position: fixed;\n        pointer-events: none;\n        background: rgba(59, 130, 246, 0.1);\n        border: 1px solid rgba(59, 130, 246, 0.5);\n        z-index: 2147483646;\n        display: none;\n        transition: all 0.05s ease-out;\n    ";const r=document.createElement("span");r.style.cssText="\n        position: absolute;\n        top: -24px;\n        left: 0;\n        background: #3b82f6;\n        color: white;\n        padding: 2px 6px;\n        font-family: Consolas, monospace;\n        font-size: 12px;\n        border-radius: 2px;\n        pointer-events: none;\n        white-space: nowrap;\n    ",o.appendChild(r),function e(){document.body?document.body.appendChild(o):document.addEventListener("DOMContentLoaded",e)}(),window.addEventListener("message",r=>{r.data&&"togglePicker"===r.data.command&&(console.log("[DEBUG] üì• Injected script received togglePicker:",r.data.enabled),e=r.data.enabled,e&&(n=!1),e?(document.body.style.cursor="crosshair",console.log("[DEBUG] üîß Picker enabled - click on an element to select it")):(o.style.display="none",t=null,document.body.style.cursor="",console.log("[DEBUG] üîß Picker disabled"))),r.data&&"toggleSnipper"===r.data.command&&(console.log("[DEBUG] üì• Injected script received toggleSnipper:",r.data.enabled),n=r.data.enabled,n&&(e=!1,console.log("[DEBUG] üîß Disabled picker, enabling snipper mode")),n?(document.body.style.cursor="crosshair",console.log("[DEBUG] üéØ Creating snipper overlay..."),i||(i=document.createElement("div"),i.id="visual-browser-snipper-overlay",i.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100vw;\n            height: 100vh;\n            z-index: 2147483647;\n            background: rgba(0, 0, 0, 0.3);\n            cursor: crosshair;\n        ",s=document.createElement("div"),s.style.cssText="\n            position: absolute;\n            border: 2px solid #3b82f6;\n            background: rgba(59, 130, 246, 0.1);\n            display: none;\n            pointer-events: none;\n        ",i.appendChild(s),document.body.appendChild(i),i.addEventListener("mousedown",u),i.addEventListener("mousemove",h),i.addEventListener("mouseup",p)),console.log("[DEBUG] ‚úÖ Snipper overlay created - drag to select area")):(document.body.style.cursor="",console.log("[DEBUG] üóëÔ∏è Removing snipper overlay"),d()))});let i=null,s=null,l=0,a=0,c=!1;function d(){i&&(i.remove(),i=null,s=null)}function u(e){console.log("[DEBUG] üñ±Ô∏è Mouse DOWN - starting selection"),c=!0,l=e.clientX,a=e.clientY,s&&(s.style.display="block",s.style.left=l+"px",s.style.top=a+"px",s.style.width="0px",s.style.height="0px")}function h(e){if(!c||!s)return;const t=e.clientX,n=e.clientY,o=Math.abs(t-l),r=Math.abs(n-a),i=Math.min(t,l),d=Math.min(n,a);s.style.width=o+"px",s.style.height=r+"px",s.style.left=i+"px",s.style.top=d+"px"}function p(e){if(console.log("[DEBUG] üñ±Ô∏è Mouse UP - selection complete"),c=!1,!s||!i)return;const t=s.getBoundingClientRect();console.log("[DEBUG] üìê Page dimensions:",{pageWidth:document.documentElement.scrollWidth,pageHeight:document.documentElement.scrollHeight,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY}),console.log("[DEBUG] üìê Selected area (viewport):",{width:t.width,height:t.height,left:t.left,top:t.top});const n=t.left+window.scrollX,r=t.top+window.scrollY;console.log("[DEBUG] üìê Selected area (absolute):",{captureX:n,captureY:r,endX:t.right+window.scrollX,endY:t.bottom+window.scrollY}),t.width>5&&t.height>5?(console.log("[DEBUG] üì∏ Starting screenshot capture..."),i.style.display="none",o&&(o.style.display="none"),requestAnimationFrame(async()=>{try{const e=performance.now(),n=2,o=await I(document.documentElement,{pixelRatio:n,cacheBust:!1,skipFonts:!0,skipAutoScale:!0,style:{transform:"none"},filter:e=>{const t=e;if("none"===t.style?.display||"hidden"===t.style?.visibility)return!1;if("visual-browser-injected-overlay"===t.id||"visual-browser-snipper-overlay"===t.id||"react-toolbar-root"===t.id||"visual-browser-devtools-overlay"===t.id)return!1;if("IMG"===t.tagName){const e=t.getAttribute("src")||"";if(e.startsWith("http")&&!e.startsWith(window.location.origin))return!1}return!0}}),r=performance.now();console.log(`[Snipper] toPng captured in ${(r-e).toFixed(0)}ms`);const i=new Image;i.onload=()=>{try{console.log("[DEBUG] üñºÔ∏è Image loaded, cropping...");const e=document.createElement("canvas"),o=e.getContext("2d");if(!o)return;e.width=t.width,e.height=t.height;const r=(t.left+window.scrollX)*n,s=(t.top+window.scrollY)*n,l=t.width*n,a=t.height*n;console.log("[DEBUG] üìê Cropping with scale correction:",{sourceX:r,sourceY:s,sourceWidth:l,sourceHeight:a,viewportLeft:t.left,viewportTop:t.top,scrollX:window.scrollX,scrollY:window.scrollY,pixelRatio:n}),o.drawImage(i,r,s,l,a,0,0,t.width,t.height);const c=e.toDataURL("image/jpeg",.8);console.log("[DEBUG] üì§ Sending screenshotCaptured to webview, size:",c.length),window.parent.postMessage({command:"screenshotCaptured",data:c},"*"),console.log("[DEBUG] ‚úÖ Screenshot sent to webview!")}catch(e){console.error("[Screenshot Debug] Canvas processing failed:",e)}},i.onerror=()=>{console.error("[Screenshot Debug] Image failed to load - possibly due to CORS"),console.log("[DEBUG] üì§ Sending FULL screenshot (no crop) as fallback, size:",o.length),window.parent.postMessage({command:"screenshotCaptured",data:o},"*")},i.src=o}catch(e){console.error("[Screenshot Debug] Capture failed:",e)}}),console.log("[DEBUG] üßπ Cleaning up snipper overlay"),d(),window.parent.postMessage({command:"toggleSnipper",enabled:!1},"*")):(console.log("[DEBUG] ‚ùå Selection too small, canceling"),d(),window.parent.postMessage({command:"toggleSnipper",enabled:!1},"*"))}let g=null;document.addEventListener("mousemove",n=>{e&&(g||(g=requestAnimationFrame(()=>{g=null;const e=n.target;if(e!==o&&e!==r&&t!==e){t=e;const n=e.getBoundingClientRect();o.style.display="block",o.style.transform=`translate(${n.left}px, ${n.top}px)`,o.style.width=n.width+"px",o.style.height=n.height+"px",o.style.top="0",o.style.left="0";const i=e.id?"#"+e.id:"",s=e.tagName?e.tagName.toLowerCase():"";r.textContent=s+i+" "+Math.round(n.width)+"x"+Math.round(n.height)}})))},!0),document.addEventListener("click",async t=>{if(console.log("[DEBUG] üñ±Ô∏è CLICK EVENT TRIGGERED! pickerEnabled =",e),!e)return void console.log("[DEBUG] ‚ùå Click ignored - picker not enabled");console.log("[DEBUG] üîò Element picker - user clicked on element"),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const n=t.target,r=function(e){const t=e.getBoundingClientRect(),n=function(e){if(!e)return"";const t=[];let n=e;for(;n&&n.parentNode&&"HTML"!==n.tagName;){let e=n.tagName.toLowerCase();if(n.id){e+="#"+n.id,t.unshift(e);break}n.className&&"string"==typeof n.className&&n.className.trim()&&(e+="."+n.className.trim().split(/\s+/).join(".")),t.unshift(e),n=n.parentNode}return t.join(" > ")}(e),o=function(e){const t=window.getComputedStyle(e),n=t.display.includes("flex"),o=t.display.includes("grid");let r=`display=${t.display}`;return(n||o)&&(r+=`, gap=${t.gap}`,r+=`, justify=${t.justifyContent}`,r+=`, align=${t.alignItems}`,n&&(r+=`, direction=${t.flexDirection}`)),{color:t.color,background:t.backgroundColor,fontSize:t.fontSize,fontFamily:t.fontFamily,font:`${t.fontSize} ${t.fontFamily}`,model:`m:${t.margin}, p:${t.padding}, border:${t.borderWidth}`,layout:r,visibility:`z-index=${t.zIndex}, opacity=${t.opacity}, visibility=${t.visibility}`}}(e),r=function(e){if(!e.hasAttributes())return"";const t=[];for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n];"class"!==o.name&&"style"!==o.name&&"id"!==o.name&&t.push(`${o.name}="${o.value}"`)}return t.length>0?"Attributes: "+t.join(" "):""}(e),i=e.outerHTML,s=i.length,l=i.replace(/\s+/g," ").trim();return`\n**Picked Element Details:**\n\n- **DOM Path:** \`${n}\`\n- **Position:** \`top=${Math.round(t.top)}px\`, \`left=${Math.round(t.left)}px\`, \`width=${Math.round(t.width)}px\`, \`height=${Math.round(t.height)}px\`\n\n**Visual Properties:**\n- **Styles:** \`color=${o.color}\`, \`bg=${o.background}\`, \`font=${o.font}\`\n- **Layout:** \`display=${o.layout.split("=")[1]||o.layout}\`, \`${o.model}\`\n- **Visibility:** \`${o.visibility}\`\n${r?"- **Attributes:** `"+r+"`":""}\n\n**HTML:** (${s} chars)\n\`\`\`html\n${l}\n\`\`\`\n`.trim()}(n);o.style.display="none";let i=null;try{const e=performance.now();console.log("[DEBUG] üì∏ Element picker - capturing screenshot...");const t=window.getComputedStyle(n).backgroundColor,o=await I(n,{pixelRatio:2,cacheBust:!1,skipFonts:!0,style:{backgroundColor:"rgba(0, 0, 0, 0)"!==t&&"transparent"!==t?t:void 0}}),r=performance.now();console.log(`[DEBUG] üì∏ Element screenshot captured in ${(r-e).toFixed(0)}ms, length: ${o?.length}`),o&&(i=o,console.log("[DEBUG] üì§ Sending elementPicked with screenshot to webview"))}catch(e){console.error("[DEBUG] ‚ùå Element screenshot failed:",e)}window.parent.postMessage({command:"elementPicked",text:r,elementScreenshot:i},"*"),console.log("[DEBUG] ‚úÖ Element picker message sent - picker remains enabled for next pick"),o.style.display="block"},!0)}()})();